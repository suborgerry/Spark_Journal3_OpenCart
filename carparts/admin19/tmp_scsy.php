<?
require_once("prolog.php");

$aRpl = Array(100019=>1,
100005=>2,
100002=>3,
100013=>4,
100006=>5,
103099=>6,
100011=>7,
100016=>8,
100050=>9,
100008=>10,
100001=>11,
100010=>12,
100239=>13,
100240=>14,
100018=>15,
100014=>16,
100214=>17,
100012=>18,
100007=>19,
100004=>20,
100733=>21,
100243=>22,
100241=>23,
100400=>24,
100343=>25,
100254=>26,
100685=>27,
103202=>28,
100417=>29,
100341=>30,
100335=>31,
103168=>32,
100339=>33,
104152=>34,
101994=>35,
102205=>36,
100151=>37,
100152=>38,
100133=>39,
100626=>40,
100627=>41,
100491=>42,
101815=>45,
102203=>46,
100453=>47,
100455=>48,
100603=>49,
100259=>50,
100260=>51,
100261=>52,
100263=>53,
102901=>54,
100262=>55,
100713=>56,
101994=>57,
100223=>58,
104302=>59,
104377=>60,
103397=>61,
100245=>62,
100754=>63,
100003=>64,
100383=>65,
100535=>66,
100373=>67,
100515=>68,
100514=>69,
103037=>70,
100541=>71,
103437=>72,
100700=>73,
103129=>74,
100209=>75,
100210=>76,
100206=>77,
100211=>78,
100208=>79,
100213=>80,
100735=>81,
100207=>82,
100212=>83,
100758=>84,
100834=>85,
102733=>86,
103159=>87,
100626=>88,
100627=>89,
100027=>90,
100038=>91,
102208=>92,
100028=>93,
100631=>94,
100026=>95,
100034=>96,
100635=>97,
101924=>98,
100808=>99,
100039=>100,
100025=>101,
102248=>102,
100382=>103,
100037=>104,
102224=>105,
100035=>106,
100036=>107,
100029=>108,
103154=>109,
103100=>110,
103101=>111,
103102=>112,
103479=>113,
100121=>114,
100113=>115,
100371=>116,
100381=>117,
100370=>118,
102201=>119,
100810=>120,
101884=>121,
100340=>122,
104406=>123,
100085=>124,
100082=>125,
100080=>126,
101971=>127,
102898=>128,
102239=>129,
101482=>130,
103130=>131,
100053=>132,
100052=>133,
100054=>134,
104813=>135,
102784=>136,
100059=>137,
100051=>138,
100079=>139,
100264=>140,
100832=>141,
104511=>142,
102877=>143,
102370=>144,
100057=>145,
104718=>146,
103156=>147,
100151=>148,
100152=>149,
100150=>150,
100148=>151,
100153=>152,
100757=>153,
103016=>154,
100328=>155,
100247=>156,
100246=>157,
100249=>158,
100827=>159,
100830=>160,
100848=>161,
103139=>162,
100744=>163,
101465=>164,
100826=>165,
100746=>166,
100219=>167,
100743=>168,
101648=>169,
101705=>170,
101690=>171,
101407=>172,
103213=>173,
101340=>174,
104728=>175,
101454=>176,
105577=>177,
100217=>178,
100042=>179,
102747=>180,
100041=>181,
100143=>182,
100043=>183,
100511=>184,
100787=>185,
102336=>186,
100320=>187,
100785=>188,
103428=>189,
101826=>190,
103066=>191,
100708=>192,
100353=>193,
100307=>194,
100884=>195,
104741=>196,
100322=>197,
102661=>198,
100295=>199,
100727=>200,
103136=>201,
101993=>202,
100769=>203,
103065=>204,
101808=>205,
100772=>206,
103103=>207,
101809=>208,
102930=>209,
100774=>210,
102685=>211,
103110=>212,
102781=>213,
101815=>214,
100770=>215,
101812=>216,
100776=>217,
100773=>218,
100775=>219,
105494=>220,
103475=>221,
101853=>222,
101810=>223,
102215=>224,
102931=>225,
103436=>226,
101817=>227,
103109=>228,
101814=>229,
105997=>230,
102783=>231,
100133=>232,
100136=>233,
100342=>234,
100611=>235,
100137=>236,
100134=>237,
100135=>238,
100613=>239,
100610=>240,
100612=>241,
100062=>242,
100074=>243,
100071=>244,
100070=>245,
100066=>246,
103398=>247,
100253=>248,
100251=>249,
102603=>250,
103086=>251,
100250=>252,
100258=>253,
100268=>254,
100269=>255,
104262=>256,
100270=>257,
100252=>258,
103077=>259,
100267=>260,
103148=>261,
100601=>262,
100198=>263,
102203=>264,
100199=>265,
100593=>266,
100202=>267,
102766=>268,
103133=>269,
100591=>270,
100203=>271,
100594=>272,
101857=>273,
100201=>274,
100200=>275,
100592=>276,
104391=>277,
102073=>278,
100565=>279,
102928=>280,
102205=>281,
100102=>282,
100337=>283,
100094=>284,
100334=>285,
100088=>286,
100344=>287,
100099=>288,
100338=>289,
100874=>290,
102447=>291,
103131=>292,
100046=>293,
100314=>294,
103414=>295,
100319=>296,
100048=>297,
100715=>298,
100047=>299,
100714=>300,
104273=>301,
100873=>302,
100318=>303,
100315=>304,
100872=>305,
102451=>306,
100196=>307,
100222=>308,
103019=>309,
100195=>310,
104629=>311,
100861=>312,
103443=>313,
103485=>314,
100732=>315,
100354=>316,
100355=>317,
100356=>318,
100794=>319,
100358=>320,
100357=>321,
100363=>322,
100728=>323,
100360=>324,
100865=>325,
100779=>326,
100366=>327,
102922=>328,
100809=>329,
100346=>330,
100347=>331,
100349=>332,
102219=>333,
100725=>334,
100777=>335,
101470=>336,
100348=>337,
100726=>338,
101996=>339,
100703=>340,
100415=>341,
100416=>342,
103456=>343,
100768=>344,
100367=>345,
100607=>346,
100608=>347,
103009=>348,
100368=>349,
100752=>350,
100609=>351,
102793=>352,
102903=>353,
100790=>354,
100686=>355,
100687=>356,
100688=>357,
100819=>358,
100690=>359,
100689=>360,
100766=>361,
100691=>362,
103203=>363,
103352=>364,
100421=>365,
100419=>366,
100680=>367,
100762=>368,
104739=>369,
100730=>370,
102693=>371,
102695=>372,
100673=>373,
102706=>374,
103004=>375,
100854=>376,
102692=>377,
102697=>378,
102694=>379,
102998=>380,
102691=>381,
104958=>382,
102689=>383,
102696=>384,
103399=>385,
102698=>386,
102690=>387,
100863=>388,
100618=>389,
100751=>390,
104156=>391,
100615=>392,
100616=>393,
100850=>394,
100625=>395,
100617=>396,
100614=>397,
104155=>398,
102736=>399,
103193=>400,
103183=>401,
103171=>402,
103197=>403,
103169=>404,
103196=>405,
103198=>406,
100697=>407,
100694=>408,
100695=>409,
100693=>410,
103449=>411,
104395=>412,
104153=>413,
100197=>414,
100602=>415,
100603=>416,
100453=>417,
100452=>418,
100461=>419,
100877=>420,
102029=>421,
100459=>422,
100455=>423,
100457=>424,
102016=>425,
100225=>426,
100234=>427,
100789=>428,
100233=>429,
100235=>430,
100227=>431,
100231=>432,
100229=>433,
100684=>434,
100228=>435,
100683=>436,
100682=>437,
100244=>438,
100224=>439,
100745=>440,
100566=>441,
100103=>442,
100108=>443,
100104=>444,
100105=>445,
100112=>446,
100030=>447,
100032=>448,
102244=>449,
100630=>450,
100839=>451,
100707=>452,
100805=>453,
102803=>454,
102797=>455,
102802=>456,
102811=>457,
102809=>458,
102806=>459,
102796=>460,
102807=>461,
102804=>462,
102800=>463,
102799=>464,
102795=>465,
102798=>466,
104704=>467,
102808=>468,
102805=>469,
103082=>470,
102810=>471,
102794=>472,
102801=>473,
103150=>474,
102763=>475,
100031=>476,
100033=>477,
100633=>478,
102965=>479,
102964=>480,
100634=>481,
103210=>482,
103194=>483,
103195=>484,
104317=>485,
104303=>486,
104308=>487,
104330=>488,
104329=>490,
104331=>491,
104328=>492,
104332=>493,
103450=>494,
100350=>495,
100351=>496,
100352=>497,
100573=>498,
100574=>499,
100590=>500,
100577=>501,
100596=>502,
100427=>503,
100723=>504,
100430=>505,
100433=>506,
100516=>507,
100279=>508,
706161=>509,
100717=>510,
100718=>511,
100719=>512,
100431=>513,
100432=>514,
100441=>515,
100876=>516,
100438=>517,
102037=>518,
100435=>519,
100434=>520,
101467=>521,
101468=>522,
101466=>523,
101469=>524,
100807=>525,
100806=>526,
100145=>527,
100870=>528,
100275=>529,
100291=>530,
100292=>531,
100287=>532,
100285=>533,
100290=>534,
100284=>535,
100289=>536,
100147=>537,
101966=>538,
100578=>539,
102250=>540,
100579=>541,
100580=>542,
100803=>543,
100055=>544,
102080=>545,
100056=>546,
100237=>547,
100276=>548,
100280=>549,
100277=>550,
102671=>551,
100869=>552,
100281=>553,
100095=>554,
100096=>555,
102904=>556,
102906=>557,
102913=>558,
102907=>559,
102905=>560,
102911=>561,
102909=>562,
102908=>563,
102912=>564,
102914=>565,
102910=>566,
100581=>567,
100583=>568,
100192=>569,
100184=>570,
100189=>571,
102414=>572,
102731=>573,
100778=>574,
102760=>575,
100741=>576,
100740=>577,
100185=>578,
100187=>579,
100181=>580,
100168=>581,
104812=>582,
101504=>583,
100737=>584,
104382=>585,
100155=>586,
100699=>587,
100191=>588,
100739=>589,
104959=>590,
100165=>591,
100164=>592,
100169=>593,
100166=>594,
100606=>595,
100537=>596,
101649=>597,
101655=>598,
101650=>599,
101654=>600,
103035=>601,
101673=>602,
101665=>603,
101656=>604,
101661=>605,
101669=>606,
101766=>607,
101651=>608,
101653=>609,
101652=>610,
104724=>611,
100470=>612,
100477=>613,
100476=>614,
100513=>615,
100474=>616,
100478=>617,
100479=>618,
100475=>619,
100472=>620,
100481=>621,
100512=>622,
103072=>623,
100838=>624,
100450=>625,
100451=>626,
100887=>627,
100765=>628,
101707=>629,
101706=>630,
101784=>631,
101780=>632,
101779=>633,
101782=>634,
101783=>635,
101781=>636,
103036=>637,
101708=>638,
101745=>639,
101739=>640,
101715=>641,
101727=>642,
101722=>643,
101785=>644,
101735=>645,
101731=>646,
101718=>647,
101763=>648,
101711=>649,
101710=>650,
100091=>651,
100089=>652,
102211=>653,
102984=>654,
104956=>655,
706034=>656,
199002=>657,
199004=>658,
199011=>659,
199001=>660,
199005=>661,
199007=>662,
199008=>663,
199003=>664,
199013=>665,
199009=>666,
199006=>667,
199010=>668,
199012=>669,
100571=>670,
100572=>671,
100030=>672,
100032=>673,
102244=>674,
100630=>675,
100791=>676,
100793=>677,
103047=>678,
100792=>679,
100833=>680,
101694=>681,
101698=>682,
101692=>683,
101697=>684,
101693=>685,
101700=>686,
101691=>687,
101696=>688,
101760=>689,
102758=>690,
101695=>691,
101699=>692,
101420=>693,
101415=>694,
101424=>695,
101441=>696,
101452=>697,
103118=>698,
101408=>699,
101428=>700,
101432=>701,
101411=>702,
101854=>703,
101855=>704,
102763=>705,
100031=>706,
100033=>707,
100633=>708,
102965=>709,
102964=>710,
100634=>711,
103210=>712,
100100=>713,
100215=>714,
100840=>715,
100396=>716,
100403=>717,
104695=>718,
100397=>719,
101833=>720,
100422=>721,
100401=>722,
100425=>723,
100399=>724,
100398=>725,
100852=>726,
103215=>727,
103214=>728,
103469=>729,
100831=>730,
102754=>731,
100061=>732,
100060=>733,
100780=>734,
101926=>735,
100077=>736,
100298=>737,
102673=>738,
100712=>739,
105589=>740,
101341=>745,
101349=>746,
101345=>747,
101353=>748,
100704=>749,
100384=>750,
100385=>751,
102872=>752,
102235=>753,
100387=>754,
100818=>755,
100390=>756,
100388=>757,
100386=>758,
100389=>759,
100538=>760,
100536=>761,
100539=>762,
104164=>763,
104157=>764,
104159=>765,
105588=>766,
104165=>767,
104161=>768,
104166=>769,
104162=>770,
105585=>771,
104167=>772,
105586=>773,
105584=>774,
104160=>775,
105582=>776,
104158=>777,
104163=>778,
104169=>779,
104364=>780,
104275=>781,
104274=>782,
100587=>783,
100589=>784,
102082=>785,
100588=>786,
103170=>787,
103400=>788,
100380=>797,
100374=>798,
102450=>799,
100375=>800,
100377=>801,
100376=>802,
100788=>803,
102778=>804,
100379=>805,
100378=>806,
100359=>807,
100362=>808,
100040=>809,
100586=>810,
100585=>811,
100761=>812,
100521=>813,
100519=>814,
100518=>815,
100520=>816,
100517=>817,
103120=>818,
104396=>819,
100724=>820,
100509=>821,
100510=>822,
104394=>823,
100533=>824,
105861=>825,
100534=>826,
105864=>827,
105860=>828,
105862=>829,
103199=>830,
103201=>831,
103200=>832,
100555=>833,
100553=>834,
100561=>835,
100729=>836,
100542=>837,
100552=>838,
100866=>839,
100327=>841,
100316=>842,
100330=>843,
100317=>844,
102875=>845,
100331=>846,
100333=>847,
100325=>848,
103111=>849,
100329=>850,
100332=>851,
100323=>852,
100321=>853,
100326=>854,
100716=>855,
100324=>856,
102225=>857,
102227=>858,
102226=>859,
102228=>860,
102231=>861,
103023=>862,
103062=>863,
103021=>864,
103401=>865,
103091=>866,
103020=>867,
103089=>868,
103022=>869,
100701=>870,
100702=>871);


$CPMod->LQ('SELECT * FROM CM_NODS');
while($a = $CPMod->LFetch()){
	//$aNods[$a['NOD']][$a['LANG']] = $a;
	$aNods[]=$a;
}

$CPMod->LQ('SELECT * FROM CM_SECTIONS');
while($a = $CPMod->LFetch()){
	$aSct[$a['Nod']][$a['Lang']] = $a;
}

if($_POST['Snchr']){
	foreach($aNods as $sNod => $aN){
		if($aN['NAME']!='' AND $aN['NAME'] != $aSct[$aRpl[$aN['NOD']]][$aN['LANG']]['Native']){
			$NAME = $CPMod->LocMyQi->real_escape_string($aN['NAME']);
			$Q = "UPDATE CM_SECTIONS SET Edited='".$NAME."', IsActive=".$aN['ACTIVE']." WHERE Nod=".$aRpl[$aN['NOD']]." AND Lang='".$aN['LANG']."' ";
			//echo $Q.'<br>';
			$CPMod->LQ($Q);
			$cntUpd++;
			continue;
		}
		if(isset($aSct[$aRpl[$aN['NOD']]][$aN['LANG']]['IsActive']) AND $aN['ACTIVE'] != $aSct[$aRpl[$aN['NOD']]][$aN['LANG']]['IsActive']){
			$Q = "UPDATE CM_SECTIONS SET IsActive=".$aN['ACTIVE']." WHERE Nod=".$aRpl[$aN['NOD']]." AND Lang='".$aN['LANG']."' ";
			//echo $Q.'<br>';
			$CPMod->LQ($Q);
		}
	}
	echo 'Updated: '.$cntUpd;
}
//echo '<pre>'; print_r($aNods); echo '</pre><br><br>'; die();
?>
<style>
table{font-family: Verdana; font-size: 13px; border-collapse: collapse; margin-top: 30px;}
td{border:1px solid #bfbfbf; padding:2px 5px; }
.but{padding:5px 15px; color:geen; background:#d5d5d5; font-weight:bold; font-size:14px; float:right; cursor:pointer;}
.but:hover{background:#e9e9e9;}
</style>
<div class="but">Обновить</div>
<table>
	<tr><td></td><td>CM_SECTIONS</td><td>CM_NODS</td></tr>
	<?foreach($aNods as $sNod => $aN){
		if($aN['NAME']!='' AND $aN['NAME'] != $aSct[$aRpl[$aN['NOD']]][$aN['LANG']]['Native']){?>
			<tr>
				<td><?=$aRpl[$aN['NOD']]?></td>
				<td><?=$aSct[$aRpl[$aN['NOD']]][$aN['LANG']]['Native']?></td>
				<td><?=$aN['NAME']?></td>
			</tr>
		<?}
	}?>
	
</table>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function (){
	
	$(".but").on("click","", function(e){
		$("<form action='' id='formResScts' method='post'><input type='hidden' name='Snchr' value='Y'/></form>").appendTo('body');
		$("#formResScts").submit();
	});
	
	
});
</script>